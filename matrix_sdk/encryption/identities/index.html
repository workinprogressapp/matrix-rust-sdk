<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Cryptographic identities used in Matrix."><title>matrix_sdk::encryption::identities - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../../static.files/rustdoc-fbd14db5c88ed452.css" id="mainThemeStyle"><div id="rustdoc-vars" data-root-path="../../../" data-static-root-path="../../../static.files/" data-current-crate="matrix_sdk" data-themes="" data-resource-suffix="" data-rustdoc-version="1.70.0-nightly (cf7ada217 2023-04-03)" data-search-js="search-bc5a112813b5d712.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" data-theme-light-css="light-db279b6232be9c13.css" data-theme-dark-css="dark-cf923f49f397b216.css" data-theme-ayu-css="ayu-be46fdc453a55015.css" ></div><script src="../../../static.files/storage-d4a1a279bad1a0c0.js"></script><script defer src="../../../static.files/main-8e6affb8c73a5ff1.js"></script><noscript><link rel="stylesheet" media="(prefers-color-scheme:light)" href="../../../static.files/light-db279b6232be9c13.css"><link rel="stylesheet" media="(prefers-color-scheme:dark)" href="../../../static.files/dark-cf923f49f397b216.css"><link rel="stylesheet" href="../../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../../matrix_sdk/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../../matrix_sdk/index.html"><img class="rust-logo" src="../../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module identities</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../../index.html">matrix_sdk</a>::<wbr><a href="../index.html">encryption</a>::<wbr><a class="mod" href="#">identities</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../../src/matrix_sdk/encryption/identities/mod.rs.html#15-119">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>e2e-encryption</code></strong> only.</div></span><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Cryptographic identities used in Matrix.</p>
<p>There are two types of cryptographic identities in Matrix.</p>
<ol>
<li>
<p>Devices, which are backed by <a href="https://spec.matrix.org/unstable/client-server-api/#device-keys">device keys</a>, they represent each
individual log in by an E2EE capable Matrix client. We represent devices
using the <a href="struct.Device.html" title="struct matrix_sdk::encryption::identities::Device"><code>Device</code></a> struct.</p>
</li>
<li>
<p>User identities, which are backed by <a href="https://spec.matrix.org/unstable/client-server-api/#cross-signing">cross signing keys</a>. The user
identity represent a unique E2EE capable identity of any given user. This
identity is generally created and uploaded to the server by the first E2EE
capable client the user logs in with. We represent user identities using the
<a href="struct.UserIdentity.html" title="struct matrix_sdk::encryption::identities::UserIdentity"><code>UserIdentity</code></a> struct.</p>
</li>
</ol>
<p>A <a href="struct.Device.html" title="struct matrix_sdk::encryption::identities::Device"><code>Device</code></a> or an <a href="struct.UserIdentity.html" title="struct matrix_sdk::encryption::identities::UserIdentity"><code>UserIdentity</code></a> can be used to inspect the public keys
of the device/identity, or it can be used to initiate a interactive
verification flow. They can also be manually marked as verified.</p>
<h2 id="examples"><a href="#examples">Examples</a></h2>
<p>Verifying a device is pretty straightforward:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>device =
    client.encryption().get_device(alice, <span class="macro">device_id!</span>(<span class="string">&quot;DEVICEID&quot;</span>)).<span class="kw">await</span><span class="question-mark">?</span>;

<span class="kw">if let </span><span class="prelude-val">Some</span>(device) = device {
    <span class="comment">// Let&#39;s request the device to be verified.
    </span><span class="kw">let </span>verification = device.request_verification().<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Actually this is taking too long.
    </span>verification.cancel().<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Let&#39;s just mark it as verified.
    </span>device.verify().<span class="kw">await</span><span class="question-mark">?</span>;
}</code></pre></div>
<p>Verifying a user identity works largely the same:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">let </span>user = client.encryption().get_user_identity(alice).<span class="kw">await</span><span class="question-mark">?</span>;

<span class="kw">if let </span><span class="prelude-val">Some</span>(user) = user {
    <span class="comment">// Let&#39;s request the user to be verified.
    </span><span class="kw">let </span>verification = user.request_verification().<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Actually this is taking too long.
    </span>verification.cancel().<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// Let&#39;s just mark it as verified.
    </span>user.verify().<span class="kw">await</span><span class="question-mark">?</span>;
}</code></pre></div>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.Device.html" title="struct matrix_sdk::encryption::identities::Device">Device</a></div><div class="desc docblock-short">A device represents a E2EE capable client or device of an user.</div></li><li><div class="item-name"><a class="struct" href="struct.MasterPubkey.html" title="struct matrix_sdk::encryption::identities::MasterPubkey">MasterPubkey</a></div><div class="desc docblock-short">Wrapper for a cross signing key marking it as the master key.</div></li><li><div class="item-name"><a class="struct" href="struct.UserDevices.html" title="struct matrix_sdk::encryption::identities::UserDevices">UserDevices</a></div><div class="desc docblock-short">The collection of all the <a href="struct.Device.html" title="struct matrix_sdk::encryption::identities::Device"><code>Device</code></a>s a user has.</div></li><li><div class="item-name"><a class="struct" href="struct.UserIdentity.html" title="struct matrix_sdk::encryption::identities::UserIdentity">UserIdentity</a></div><div class="desc docblock-short">A struct representing a E2EE capable identity of a user.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.ManualVerifyError.html" title="enum matrix_sdk::encryption::identities::ManualVerifyError">ManualVerifyError</a></div><div class="desc docblock-short">Error for the manual verification step, when we manually sign users or
devices.</div></li><li><div class="item-name"><a class="enum" href="enum.RequestVerificationError.html" title="enum matrix_sdk::encryption::identities::RequestVerificationError">RequestVerificationError</a></div><div class="desc docblock-short">Error when requesting a verification.</div></li></ul></section></div></main></body></html>